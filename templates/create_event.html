<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Event - Rockville City Portal</title>
    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Cookie handling -->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-blue: #1e40af;
        --secondary-blue: #3b82f6;
        --accent-gold: #f59e0b;
        --dark-blue: #1e3a8a;
        --light-blue: #dbeafe;
        --white: #ffffff;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-600: #4b5563;
        --gray-800: #1f2937;
        --gray-900: #111827;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1),
          0 8px 10px -6px rgb(0 0 0 / 0.1);
        --success-color: #10b981;
      }

      .dark {
        --primary-blue: #3b82f6;
        --secondary-blue: #60a5fa;
        --accent-gold: #fbbf24;
        --dark-blue: #1e40af;
        --light-blue: #1e3a8a;
        --white: #111827;
        --gray-50: #1f2937;
        --gray-100: #374151;
        --gray-200: #4b5563;
        --gray-300: #6b7280;
        --gray-600: #9ca3af;
        --gray-800: #e5e7eb;
        --gray-900: #f9fafb;
      }

      body {
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .glass-effect {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .text-gradient {
        background: linear-gradient(
          135deg,
          var(--primary-blue),
          var(--accent-gold)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .animate-float {
        animation: float 6s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .form-section {
        transition: all 0.3s ease;
      }

      .form-section:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .input-focus:focus {
        transform: translateY(-1px);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      #osm-map {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow-lg);
      }

      .preview-item {
        transition: all 0.3s ease;
      }

      .preview-item:hover {
        transform: scale(1.05);
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-blue),
          var(--secondary-blue)
        );
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        background: linear-gradient(
          135deg,
          var(--dark-blue),
          var(--primary-blue)
        );
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .required-field::after {
        content: " *";
        color: #ef4444;
        font-weight: bold;
      }

      .hero-pattern {
        background-image: radial-gradient(
            circle at 25px 25px,
            rgba(59, 130, 246, 0.2) 2px,
            transparent 0
          ),
          radial-gradient(
            circle at 75px 75px,
            rgba(245, 158, 11, 0.2) 2px,
            transparent 0
          );
        background-size: 100px 100px;
      }
    </style>
  </head>

  <body
    class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen"
  >
    <!-- Header -->
    <header class="fixed w-full top-0 left-0 z-50 glass-effect">
      <div
        class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between"
      >
        <div class="flex items-center space-x-4">
          <div
            class="w-10 h-10 bg-gradient-to-br from-blue-600 to-yellow-500 rounded-full flex items-center justify-center"
          >
            <i class="fas fa-city text-white text-lg"></i>
          </div>
          <h1 class="text-2xl font-bold text-gradient">Rockville</h1>
        </div>

        <nav class="hidden md:flex items-center space-x-8">
          <a
            href="/"
            class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
            >Home</a
          >
          <a
            href="/about"
            class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
            >About</a
          >
          <a
            href="/contact"
            class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
            >Contact</a
          >
          <a
            href="/news"
            class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
            >News</a
          >
        </nav>

        <div class="flex items-center space-x-4">
          <!-- Dark Mode Toggle -->
          <button
            id="dark-mode-toggle"
            class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
          >
            <i class="fas fa-moon dark:hidden"></i>
            <i class="fas fa-sun hidden dark:block"></i>
          </button>

          <!-- Auth Buttons -->
          <a
            id="login-btn"
            href="/auth/login"
            class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Login
          </a>
          <button
            id="logout-btn"
            class="hidden px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
          >
            Logout
          </button>
        </div>
      </div>
    </header>

    <!-- Hero Section -->
    <section
      class="relative pt-24 pb-12 bg-gradient-to-br from-blue-600 via-purple-600 to-yellow-500 overflow-hidden hero-pattern"
    >
      <div class="absolute inset-0 bg-black bg-opacity-30"></div>
      <div class="relative z-10 text-center text-white px-6 max-w-4xl mx-auto">
        <div class="animate-float">
          <i class="fas fa-calendar-plus text-6xl mb-6 text-yellow-300"></i>
        </div>
        <h1 class="text-4xl md:text-6xl font-bold mb-6">
          Create Community <span class="text-yellow-300">Event</span>
        </h1>
        <p class="text-lg md:text-xl text-blue-100 max-w-2xl mx-auto">
          Bring the Rockville community together by organizing events that
          matter
        </p>
      </div>
    </section>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto px-6 py-12">
      <!-- Form Container -->
      <div
        class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden"
      >
        <!-- Form Header -->
        <div
          class="bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white"
        >
          <div class="flex items-center space-x-4">
            <div
              class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center"
            >
              <i class="fas fa-calendar-alt text-xl"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold">Event Registration</h2>
              <p class="text-blue-100">
                Fill out the details for your community event
              </p>
            </div>
          </div>
        </div>

        <!-- Form Content -->
        <form
          id="eventForm"
          action="/event/"
          method="POST"
          enctype="multipart/form-data"
          class="p-8 space-y-8"
        >
          <!-- Basic Information Section -->
          <div class="form-section bg-gray-50 dark:bg-gray-700 rounded-2xl p-6">
            <div class="flex items-center mb-6">
              <div
                class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3"
              >
                <i class="fas fa-info-circle text-white text-sm"></i>
              </div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                Basic Information
              </h3>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="lg:col-span-2">
                <label
                  for="title"
                  class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 required-field"
                >
                  Event Title
                </label>
                <div class="relative">
                  <div
                    class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                  >
                    <i class="fas fa-heading text-gray-400"></i>
                  </div>
                  <input
                    type="text"
                    id="title"
                    name="title"
                    placeholder="Enter your event title"
                    required
                    class="input-focus block w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white transition-all duration-300"
                  />
                </div>
              </div>

              <div class="lg:col-span-2">
                <label
                  for="description"
                  class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 required-field"
                >
                  Event Description
                </label>
                <textarea
                  id="description"
                  name="description"
                  placeholder="Provide a detailed description of your event, including activities, participants, and any special information"
                  required
                  rows="4"
                  class="input-focus block w-full px-3 py-3 border border-gray-300 dark:border-gray-600 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white resize-vertical transition-all duration-300"
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Date & Time Section -->
          <div class="form-section bg-gray-50 dark:bg-gray-700 rounded-2xl p-6">
            <div class="flex items-center mb-6">
              <div
                class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3"
              >
                <i class="fas fa-clock text-white text-sm"></i>
              </div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                Date & Time
              </h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label
                  for="datetime"
                  class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 required-field"
                >
                  Event Date & Time
                </label>
                <div class="relative">
                  <div
                    class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                  >
                    <i class="fas fa-calendar-alt text-gray-400"></i>
                  </div>
                  <input
                    type="datetime-local"
                    id="datetime"
                    name="datetime"
                    required
                    class="input-focus block w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white transition-all duration-300"
                  />
                </div>
              </div>

              <div>
                <label
                  for="duration"
                  class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 required-field"
                >
                  Duration
                </label>
                <div class="relative">
                  <div
                    class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                  >
                    <i class="fas fa-hourglass-half text-gray-400"></i>
                  </div>
                  <input
                    type="text"
                    id="duration"
                    name="duration"
                    placeholder="2:30 (2 hours 30 minutes)"
                    pattern="[0-9]{1,2}:[0-9]{2}"
                    required
                    class="input-focus block w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white transition-all duration-300"
                  />
                </div>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                  Format: HH:MM (e.g., 02:30 for 2 hours 30 minutes)
                </p>
              </div>
            </div>
          </div>

          <!-- Location Section -->
          <div class="form-section bg-gray-50 dark:bg-gray-700 rounded-2xl p-6">
            <div class="flex items-center mb-6">
              <div
                class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mr-3"
              >
                <i class="fas fa-map-marker-alt text-white text-sm"></i>
              </div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                Location
              </h3>
            </div>

            <div class="space-y-6">
              <div>
                <label
                  class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 required-field"
                >
                  Select Location
                </label>
                <div class="flex flex-wrap gap-3 mb-4">
                  <button
                    type="button"
                    id="useMyLocation"
                    class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
                  >
                    <i class="fas fa-location-arrow mr-2"></i>
                    Use My Location
                  </button>
                  <button
                    type="button"
                    id="selectOnMap"
                    class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"
                  >
                    <i class="fas fa-map-marked-alt mr-2"></i>
                    Select on Map
                  </button>
                </div>
              </div>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <label
                    for="location"
                    class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 required-field"
                  >
                    Coordinates
                  </label>
                  <div class="relative">
                    <div
                      class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                    >
                      <i class="fas fa-map-pin text-gray-400"></i>
                    </div>
                    <input
                      type="text"
                      id="location"
                      name="location"
                      placeholder="Coordinates will appear here"
                      readonly
                      required
                      class="block w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-xl shadow-sm bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white"
                    />
                  </div>
                </div>

                <div>
                  <label
                    for="location-description"
                    class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Address/Description
                  </label>
                  <div class="relative">
                    <div
                      class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                    >
                      <i class="fas fa-road text-gray-400"></i>
                    </div>
                    <input
                      type="text"
                      id="location-description"
                      name="location_description"
                      placeholder="Street address, building name, or landmark"
                      class="input-focus block w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white transition-all duration-300"
                    />
                  </div>
                </div>
              </div>

              <div id="osm-map" class="h-80 w-full"></div>
            </div>
          </div>

          <!-- Media Section -->
          <div class="form-section bg-gray-50 dark:bg-gray-700 rounded-2xl p-6">
            <div class="flex items-center mb-6">
              <div
                class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center mr-3"
              >
                <i class="fas fa-images text-white text-sm"></i>
              </div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                Media Files
              </h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Photos -->
              <div>
                <label
                  for="photo"
                  class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"
                >
                  Event Photos
                </label>
                <div class="relative">
                  <input
                    type="file"
                    id="photo"
                    name="photo"
                    accept="image/*"
                    multiple
                    class="hidden"
                  />
                  <label
                    for="photo"
                    class="cursor-pointer block w-full p-6 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:border-blue-500 dark:hover:border-blue-400 transition-colors bg-white dark:bg-gray-800"
                  >
                    <div class="text-center">
                      <i class="fas fa-camera text-3xl text-gray-400 mb-2"></i>
                      <p
                        class="text-sm font-medium text-gray-600 dark:text-gray-400"
                      >
                        Click to upload photos
                      </p>
                      <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                        PNG, JPG, JPEG up to 10MB each
                      </p>
                    </div>
                  </label>
                </div>
                <div
                  id="photo-preview"
                  class="mt-4 grid grid-cols-3 gap-3"
                ></div>
              </div>

              <!-- Video -->
              <div>
                <label
                  for="video"
                  class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"
                >
                  Event Video
                </label>
                <div class="relative">
                  <input
                    type="file"
                    id="video"
                    name="video"
                    accept="video/*"
                    class="hidden"
                  />
                  <label
                    for="video"
                    class="cursor-pointer block w-full p-6 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:border-blue-500 dark:hover:border-blue-400 transition-colors bg-white dark:bg-gray-800"
                  >
                    <div class="text-center">
                      <i class="fas fa-video text-3xl text-gray-400 mb-2"></i>
                      <p
                        class="text-sm font-medium text-gray-600 dark:text-gray-400"
                      >
                        Click to upload video
                      </p>
                      <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                        MP4, AVI, MOV up to 50MB
                      </p>
                    </div>
                  </label>
                </div>
                <div id="video-preview" class="mt-4"></div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div
            class="flex flex-col sm:flex-row gap-4 justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-600"
          >
            <a
              href="/"
              class="inline-flex items-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors font-medium"
            >
              <i class="fas fa-arrow-left mr-2"></i>
              Back to Home
            </a>

            <button
              type="submit"
              class="btn-primary inline-flex items-center px-8 py-3 text-white rounded-xl font-semibold"
            >
              <i class="fas fa-check-circle mr-2"></i>
              Create Event
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 mt-12">
      <div class="max-w-7xl mx-auto px-6 text-center">
        <div class="flex items-center justify-center mb-6">
          <div
            class="w-12 h-12 bg-gradient-to-br from-blue-600 to-yellow-500 rounded-full flex items-center justify-center mr-4"
          >
            <i class="fas fa-city text-white text-xl"></i>
          </div>
          <h3 class="text-2xl font-bold">Rockville City Portal</h3>
        </div>
        <p class="text-gray-400 mb-4">
          Building a better community together through technology and civic
          engagement.
        </p>
        <p class="text-gray-500">
          © <span id="year"></span> Rockville City Portal. All rights reserved.
        </p>
      </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Dark mode functionality
      const darkModeToggle = document.getElementById("dark-mode-toggle");
      const html = document.documentElement;

      const currentTheme = localStorage.getItem("theme") || "light";
      html.classList.toggle("dark", currentTheme === "dark");

      darkModeToggle.addEventListener("click", () => {
        html.classList.toggle("dark");
        const theme = html.classList.contains("dark") ? "dark" : "light";
        localStorage.setItem("theme", theme);
      });

      // Auth functionality
      document.addEventListener("DOMContentLoaded", async function () {
        const token = Cookies.get("access_token");
        const loginBtn = document.getElementById("login-btn");
        const logoutBtn = document.getElementById("logout-btn");

        if (token) {
          loginBtn?.classList.add("hidden");
          logoutBtn?.classList.remove("hidden");

          logoutBtn?.addEventListener("click", async () => {
            try {
              const response = await fetch("/auth/logout", { method: "POST" });
              Cookies.remove("access_token");
              window.location.href = response.redirected ? response.url : "/";
            } catch (err) {
              console.error("Logout failed:", err);
              alert("Something went wrong while logging out.");
            }
          });
        } else {
          loginBtn?.classList.remove("hidden");
          logoutBtn?.classList.add("hidden");
        }
      });

      // Initialize map centered on Rockville, MD
      const map = L.map("osm-map").setView([39.084, -77.1528], 13);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      const officialIcon = L.icon({
        iconUrl:
          "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
      });

      let marker;

      // Add marker on click
      map.on("click", function (e) {
        if (marker) {
          map.removeLayer(marker);
        }
        marker = L.marker(e.latlng, { icon: officialIcon }).addTo(map);
        document.getElementById("location").value = `${e.latlng.lat.toFixed(
          6
        )}, ${e.latlng.lng.toFixed(6)}`;
      });

      // Use current location
      document
        .getElementById("useMyLocation")
        .addEventListener("click", function () {
          if (navigator.geolocation) {
            this.innerHTML =
              '<i class="fas fa-spinner fa-spin mr-2"></i>Finding location...';

            navigator.geolocation.getCurrentPosition(
              function (position) {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;

                if (marker) {
                  map.removeLayer(marker);
                }

                map.setView([lat, lng], 16);
                marker = L.marker([lat, lng], { icon: officialIcon }).addTo(
                  map
                );
                document.getElementById("location").value = `${lat.toFixed(
                  6
                )}, ${lng.toFixed(6)}`;

                document.getElementById("useMyLocation").innerHTML =
                  '<i class="fas fa-location-arrow mr-2"></i>Use My Location';
              },
              function (error) {
                alert("Unable to retrieve location: " + error.message);
                document.getElementById("useMyLocation").innerHTML =
                  '<i class="fas fa-location-arrow mr-2"></i>Use My Location';
              }
            );
          } else {
            alert("Geolocation is not supported by this browser.");
          }
        });

      // Select on map button
      document
        .getElementById("selectOnMap")
        .addEventListener("click", function () {
          alert("Click anywhere on the map to set the event location");
        });

      // File preview functionality
      document.getElementById("photo").addEventListener("change", function (e) {
        const previewContainer = document.getElementById("photo-preview");
        previewContainer.innerHTML = "";

        for (let file of e.target.files) {
          const reader = new FileReader();

          reader.onload = function (event) {
            const previewItem = document.createElement("div");
            previewItem.className =
              "preview-item relative rounded-lg overflow-hidden shadow-md";

            const img = document.createElement("img");
            img.src = event.target.result;
            img.className = "w-full h-20 object-cover";

            const removeBtn = document.createElement("button");
            removeBtn.type = "button";
            removeBtn.className =
              "absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-colors";
            removeBtn.innerHTML = "×";
            removeBtn.addEventListener("click", function () {
              previewItem.remove();
            });

            previewItem.appendChild(img);
            previewItem.appendChild(removeBtn);
            previewContainer.appendChild(previewItem);
          };

          reader.readAsDataURL(file);
        }
      });

      document.getElementById("video").addEventListener("change", function (e) {
        const previewContainer = document.getElementById("video-preview");
        previewContainer.innerHTML = "";

        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          const url = URL.createObjectURL(file);

          const previewItem = document.createElement("div");
          previewItem.className =
            "preview-item relative rounded-lg overflow-hidden shadow-md";

          const video = document.createElement("video");
          video.src = url;
          video.controls = true;
          video.className = "w-full h-32 object-cover";

          const removeBtn = document.createElement("button");
          removeBtn.type = "button";
          removeBtn.className =
            "absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm hover:bg-red-600 transition-colors";
          removeBtn.innerHTML = "×";
          removeBtn.addEventListener("click", function () {
            previewItem.remove();
            document.getElementById("video").value = "";
            URL.revokeObjectURL(url);
          });

          previewItem.appendChild(video);
          previewItem.appendChild(removeBtn);
          previewContainer.appendChild(previewItem);
        }
      });

      // Set current year in footer
      document.getElementById("year").textContent = new Date().getFullYear();

      // Form validation and enhancement
      const form = document.getElementById("eventForm");
      const inputs = form.querySelectorAll(
        "input[required], textarea[required]"
      );

      // Add real-time validation feedback
      inputs.forEach((input) => {
        input.addEventListener("blur", function () {
          if (this.value.trim() === "") {
            this.classList.add("border-red-500");
            this.classList.remove("border-gray-300", "dark:border-gray-600");
          } else {
            this.classList.remove("border-red-500");
            this.classList.add("border-green-500");
          }
        });

        input.addEventListener("input", function () {
          if (
            this.classList.contains("border-red-500") &&
            this.value.trim() !== ""
          ) {
            this.classList.remove("border-red-500");
            this.classList.add("border-green-500");
          }
        });
      });

      // Form submission with loading state
      form.addEventListener("submit", function (e) {
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;

        submitBtn.disabled = true;
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin mr-2"></i>Creating Event...';

        // Re-enable button after 3 seconds if form hasn't actually submitted
        setTimeout(() => {
          if (submitBtn.disabled) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
          }
        }, 3000);
      });

      // Duration input formatting
      const durationInput = document.getElementById("duration");
      durationInput.addEventListener("input", function (e) {
        let value = e.target.value.replace(/[^\d:]/g, "");

        // Auto-format as user types
        if (value.length === 2 && !value.includes(":")) {
          value = value + ":";
        }

        e.target.value = value;
      });

      // Set minimum date to today
      const dateTimeInput = document.getElementById("datetime");
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, "0");
      const day = String(now.getDate()).padStart(2, "0");
      const hours = String(now.getHours()).padStart(2, "0");
      const minutes = String(now.getMinutes()).padStart(2, "0");

      dateTimeInput.min = `${year}-${month}-${day}T${hours}:${minutes}`;

      // Smooth scrolling to sections on form errors
      function scrollToFirstError() {
        const firstError = form.querySelector(".border-red-500");
        if (firstError) {
          firstError.scrollIntoView({ behavior: "smooth", block: "center" });
          firstError.focus();
        }
      }

      // Enhanced map interaction
      map.on("moveend", function () {
        // Optional: Add any behavior when map view changes
      });

      // Add click handler for better UX
      document.querySelectorAll(".form-section").forEach((section) => {
        section.addEventListener("click", function () {
          const firstInput = section.querySelector("input, textarea");
          if (firstInput && !firstInput.matches(":focus")) {
            firstInput.focus();
          }
        });
      });
    </script>
  </body>
</html>
